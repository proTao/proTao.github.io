---
layout: post
date: 2018-07-06
title: 锋利的Bash(5):朝花夕拾
category: 程序员的玩具
tags:
- tools
- linux
- shell
keywords:
description:
---

> 我常想在纷扰中寻出一点闲静来,然而委实不容易.目前是这么离奇,心里是这么芜杂.

## 关于变量

1. 已经被定义的变量可以被重新定义，使用`readonly`修饰变量后，变量的值就不能被改变了。
2. 使用`unset`可以删除变量，但是不能删除**只读变量**。
3. `$*`和`$@`都表示传递给函数或脚本的所有参数，不被双引号包含时，都以`"$1" "$2" … "$n"`的形式输出所有参数。但是当它们被双引号包含时，`”$*”`会将所有的参数作为一个整体，以`”$1 $2 … $n“`的形式输出所有参数；`”$@”`会将各个参数分开，以`"$1" "$2" … "$n"`的形式输出所有参数。**因此只推荐使用`$@`一种。
4. 变量替换：
   - `${var:-word}`：如果变量 var 为空或已被删除(unset)，那么返回 word，但不改变 var 的值。这个技巧可以用于设定默认参数。
   - `${var:=word}`：如果变量 var 为空或已被删除(unset)，那么返回 word，并将 var 的值设置为 word。这个技巧可以用于设定默认参数。
   - `${var:+word}`：如果变量 var 被定义，那么返回 word，但不改变 var 的值。

## 关于函数

1. `return`用于返回，但是准确的说是叫**返回状态**，只能用`#?`在下一条命令捕获，而不能直接传递给自定义变量。因此，`return`作为返回状态值只能是整数。
2. 某些版本的bash脚本中不支持return，只能用exit退出。
3. `function`关键字是可选的，推荐统一加上关键字。

## 关于条件控制

1. `-a`是逻辑与，`-o`是或运算。

## 关于小命令

1. `printf`是高级的`echo`，因为前者由 POSIX 标准所定义，移植性要比后者好。
2. `read`读入内容，可以用于赋值变量。
3. 在当前目录下通过文件名查找一个文件，使用类似于这样的命令：`find . -iname '*something*'`。在所有路径下通过文件名查找文件，使用`locate something`。
4. `comm`命令可以用于两个文件之间的比较，它有一些选项可以用来调整输出，以便执行交集、求差、以及差集操作。
5. `watch`周期性的重复执行某个命令。

## 关于帮助文档

1. `man ascii`查看ASCII码表。
2. 使用 [explainshell](explainshell.com) 解释大段的命令。

## 关于

1. 重定向标准输出和标准错误：`>logfile 2>&1` 或者  `&>logfile`。

## 奇技淫巧

1. 使用heredoc进行多行注释。

    ```bash
    cat >/dev/null<<COMMENT
    asdasd
    COMMENT
    ```

2. ctrl-w 删除你键入的最后一个单词；ctrl-u 可以删除行内光标所在位置之前的内容；ctrl-k 可以删除光标至行尾的所有内容；ctrl-l 可以清屏。

3. 通常，为了保证命令不会在标准输入里残留一个未关闭的文件句柄捆绑在你当前所在的终端上，在命令后添加 `</dev/null` 是一个好习惯。

---

## 参考

1. 初级一点的[bash数组教程](http://www.jb51.net/article/101241.htm)
2. 高级一点的[15 个 Bash Array 数组教程](https://blog.csdn.net/liufei_learning/article/details/8000570)
3. [shell book](http://me.52fhy.com/shell-book/chapter1.html)